!function(e){function t(e){var t={Up:38,Down:40,Left:37,Right:39};return{handlePrevious:function(n){return e!=t.Up&&e!=t.Left||n(),this},handleNext:function(n){return e!=t.Down&&e!=t.Right||n(),this},handleSubmit:function(n){return e==t.Enter&&n(),this},handleCharacter:function(t){return this._searchable(e)&&t(),this},_searchable:function(e){return 0!==e&&e!=t.Up&&e!=t.Down&&e!=t.Left&&e!=t.Right}}}var n=e('<div class="stb-select-container"><span class="selected"></span></div>'),i=e('<ul class="stb-select" style="display:none;"></ul>');e.fn.stbDropdown=function(){var r=e(this);r.hide(),r.each(function(r,s){var a=n.clone(),o=i.clone(),l=e(s),c=l.find("option");l.after(a),l.appendTo(a),o.appendTo(a),c.each(function(t,n){var i=e(n),r=e("<li></li>"),s=i.prop("attributes");r.prop("attributes",s),e.each(s,function(e,t){r.attr(t.name,t.value)}),r.append(i.text()),o.append(r)});var d,u=l.children("option").filter(function(t,n){return e(n).is("[selected]")});d=0==u.length?c.first():u.first(),a.find(".selected").text(d.text()),a.on("click.stb.select",function(){var t=e(this),n=e.grep(e(".stb-select-container"),function(n){return!t.is(e(n))});e(n).find("ul").hide(),t.find("ul").toggle()}),a.on("click.stb.option","li",function(t){t.stopPropagation();var n=e(this),i=n.parents(".stb-select-container"),r=i.find("span.selected");r.text(n.text()),n.parents("ul").toggle();var s=i.find("select");s.val(n.attr("value")).change(),n.siblings().removeAttr("selected"),n.attr("selected","selected")}),a.attr("tabindex","1"),a.on("keyup.stb",function(e){var n=e.which;t(n).handlePrevious(function(){var e=a.find("li[selected]");return 0==e.length?(e.removeAttr("selected"),void a.find("li").first().attr("selected","selected")):($previous=e.first().prev(),void($previous.length>0&&(e.removeAttr("selected"),$previous.attr("selected","selected"))))}).handleNext(function(){var e=a.find("li[selected]");return 0==e.length?(e.removeAttr("selected"),void a.find("li").first().attr("selected","selected")):($next=e.first().next(),void($next.length>0&&(e.removeAttr("selected"),$next.attr("selected","selected"))))}).handleSubmit(function(){var e=a.find("li[selected]");e.first().click()}).handleCharacter(function(){String.fromCharCode(n)})}),l.on("DOMNodeInserted",function(t){var n=e(t.target);if(n.is("option")){var i=e("<li></li>"),r=n.prop("attributes");i.prop("attributes",r),e.each(r,function(e,t){i.attr(t.name,t.value)}),i.append(n.text()),o.append(i)}}),l.on("DOMNodeRemoved",function(t){var n=e(t.target);n.is("option")&&o.find("li:contains('"+n.text()+"')").remove()})})}}(jQuery);